# 搭建一个静态服务器

这个 demo 见 `Code/static-server` 文件。这个 demo 主要是为了实现**在不依靠数据库和任何框架**的情况下，如何搭建一个简单的静态服务器。

## 工具

**用到的 node 内置模块**：http、url、path、fs
**第三方插件**：mime（自动检测文件类型返回 header 的 content-type）

## 操作

1. 安装依赖 mime

2. 开启服务

```
node server.js
```

3.浏览器访问以下路径，并在 network 面板下查看所请求资源的请求头 content-type 是否正确：

- localhost/www
- localhost/index.html
- localhost/index.css

## 核心内容

### 1. 根据访问的路径（目录 or 文件）不同，分发不同的内容

```js
fs.stat(absPath, (err, statObj) => {
  if (err) {
    res.statusCode = 404;
    res.end("Not Found");
    return;
  }
  if (statObj.isFile()) {
    // 此时说明路径对应的目标是一个文件，可以直接读取然后回写
    fs.readFile(absPath, (err, data) => {
      res.setHeader("Content-type", mime.getType(absPath) + ";charset=utf-8");
      res.end(data);
    });
  } else {
    fs.readFile(path.join(absPath, "index.html"), (err, data) => {
      res.setHeader("Content-type", mime.getType(absPath) + ";charset=utf-8");
      res.end(data);
    });
  }
});
```

### 2. 根据访问的文件不同，动态设置 content-type

```js
const mime = require("mime");

fs.readFile(absPath, (err, data) => {
  res.setHeader("Content-type", mime.getType(absPath) + ";charset=utf-8");
});
```

### 3.在服务端设置路径多跟目录下查找

在 www/index.html 文件中引入 css 文件路径是这么写的：

```html
<link rel="stylesheet" href="../../index.css" />
```

而不是：

```html
<link rel="stylesheet" href="./index.css" />
```

在服务端设置路径，一般不采用相对路径，而直接从根目录下面进行查找。静态服务器跟本地开发的区别。

# 静态服务工具
